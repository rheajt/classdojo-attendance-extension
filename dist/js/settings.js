function loadApi(){gapi.load("client",getSettings),gapi.load("picker",function(){pickerLoaded=!0,document.getElementById("pick-spreadsheet").addEventListener("click",pickSheet)}),document.getElementById("settings").addEventListener("submit",saveSettings),document.getElementById("create-new").addEventListener("click",createAttendanceSheet)}function getSettings(){chrome.storage.sync.get(function(e){document.getElementById("attendance_taker").value=e.attendance_taker,document.getElementById("your_email").value=e.your_email,document.getElementById("spreadsheet-id").value=e.spreadsheet_data,document.getElementById("picker-result").innerHTML="<p>Spreadsheet ID: "+e.spreadsheet_data+"</p>"})}function createAttendanceSheet(){chrome.identity.getAuthToken(function(e){gapi.auth.setToken({access_token:e}),gapi.client.load("https://sheets.googleapis.com/$discovery/rest?version=v4").then(function(e){gapi.client.sheets.spreadsheets.create({properties:{title:"My test API spreadsheet"}}).then(function(e){document.getElementById("spreadsheet").innerHTML='<input type="text" id="spreadsheet_data" value="'+e.result.spreadsheetId+'" disabled />'})})})}function pickSheet(){pickerLoaded&&chrome.identity.getAuthToken(function(e){var t=(new google.picker.PickerBuilder).addView(google.picker.ViewId.SPREADSHEETS).enableFeature(google.picker.Feature.NAV_HIDDEN).hideTitleBar().setOAuthToken(e).setDeveloperKey("AIzaSyCZ7K3DuHyH0i8tIPoRa5Zh0hGsIVLMA-0").setCallback(pickerCallback).build();t.setVisible(!0)})}function pickerCallback(e){var t=e[google.picker.Response.ACTION];if(t==google.picker.Action.PICKED){var n=e[google.picker.Response.DOCUMENTS][0][google.picker.Document.ID];document.getElementById("picker-result").innerHTML="<p>Spreadsheet ID: "+n+"</p>",document.getElementById("spreadsheet-id").value=n}else t==google.picker.Action.CANCEL&&(document.getElementById("picker-result").innerHTML="Picker canceled.")}function saveSettings(e){e.preventDefault(),chrome.storage.sync.set({attendance_taker:document.getElementById("attendance_taker").value,your_email:document.getElementById("your_email").value,spreadsheet_data:document.getElementById("spreadsheet-id").value},function(){document.getElementById("settings").style.display="none"})}document.addEventListener("DOMContentLoaded",loadApi);var pickerLoaded=!1;