function loadApi(){gapi.load("client",getSettings),gapi.load("picker",function(){pickerLoaded=!0,document.getElementById("pick-spreadsheet").addEventListener("click",pickSheet)}),document.getElementById("settings").addEventListener("submit",saveSettings),document.getElementById("create-new").addEventListener("click",createAttendanceSheet)}function getSettings(){chrome.storage.sync.get(function(e){document.getElementById("attendance_taker").value=e.attendance_taker,document.getElementById("your_email").value=e.your_email,document.getElementById("spreadsheet-id").value=e.spreadsheet_data})}function createAttendanceSheet(){chrome.identity.getAuthToken(function(e){gapi.auth.setToken({access_token:e}),gapi.client.load("https://sheets.googleapis.com/$discovery/rest?version=v4").then(function(e){var t=(new Date).getFullYear();gapi.client.sheets.spreadsheets.create({properties:{title:"CLASS ROSTER FOR "+t+" / "+(t+1)},sheets:{properties:{title:"ATTENDANCE"},data:[{startRow:0,startColumn:0,rowData:{values:[{userEnteredValue:{stringValue:"STUDENT NAME"}},{userEnteredValue:{stringValue:"ABSENTS"}},{userEnteredValue:{stringValue:"LATES"}}]}}]}}).then(function(e){document.getElementById("spreadsheet-id").value=e.result.spreadsheetId})})})}function pickSheet(){pickerLoaded&&chrome.identity.getAuthToken(function(e){var t=window.location.protocol+"//"+window.location.host,n=(new google.picker.PickerBuilder).addView(google.picker.ViewId.SPREADSHEETS).enableFeature(google.picker.Feature.NAV_HIDDEN).hideTitleBar().setOAuthToken(e).setDeveloperKey("AIzaSyCdg9xLMDhxoBEkxDM8vVAbreGgPM_Qo9Y").setOrigin(t).setSize(598,423).setCallback(pickerCallback).build();n.setVisible(!0)})}function pickerCallback(e){var t=e[google.picker.Response.ACTION];if(t==google.picker.Action.PICKED){var n=e[google.picker.Response.DOCUMENTS][0][google.picker.Document.ID];document.getElementById("spreadsheet-id").value=n}else t==google.picker.Action.CANCEL&&console.log("picker cancel")}function saveSettings(e){e.preventDefault(),chrome.storage.sync.set({attendance_taker:document.getElementById("attendance_taker").value,your_email:document.getElementById("your_email").value,spreadsheet_data:document.getElementById("spreadsheet-id").value},function(){window.close()})}document.addEventListener("DOMContentLoaded",loadApi);var pickerLoaded=!1;